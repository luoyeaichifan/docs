---
name: shell常用
sort: 0
---

-  全词过滤,去掉空格

```
cat test.txt
carbon_address_ip_28 = 10.39.40.182
carbon_address_ip = 10.13.80.104
#carbon_address_ip = 10.39.40.183
#carbon_address_ip = 10.39.40.26

cat test.txt | grep -w carbon_address_ip | grep -v "#" | awk -F "=" '{print $2}' |sed s/[[:space:]]//g

```

- 写文件

```
cat << EOF 	> /etc/shadowsocks.json
{ 
 "server": "$1",
 "server_port": $2,
 "local_address": "127.0.0.1",
 "local_port": 1080, 
 "password": "$3",
 "timeout": 600,
 "method": "$4" 
}
EOF

#ps aufx | grep sslocal | grep -v grep | awk -F " " '{print $2}' | xargs -i kill -9 {}
cat /etc/shadowsocks.json
sslocal -c /etc/shadowsocks.json -d restart /dev/null 2>&1 &
curl --socks5 127.0.0.1:1080 http://httpbin.org/i

sh /home/go/shell/fly.sh 162.243.134.235 16896 isx.yt-84649090 aes-256-cfb
```

- 发包测试脚本

```
cat sleep.sh 
x=0
ps aufx | grep curl | grep -v grep | awk -F " " '{print $2}' | xargs -I {} kill -9 {}
sh curl.sh &
while true
do

    if [ $x == 500 ];then
        #echo 1000
        #ps aufx | grep curl | grep -v grep | awk -F " " '{print $2}' | xargs -I {} echo {}
        ps aufx | grep curl | grep -v grep | awk -F " " '{print $2}' | xargs -I {} kill -9 {} >/dev/null 2>&1
        sleep 1
        x=0
        sh curl.sh &
    fi
    x=`expr $x + 1`
done


 cat curl.sh 
#!/bin/bash
read_line()
{
    read
    while [ $? -eq 0 ]
    do
        #echo $REPLY  # 换成你想做的事情
    url=\"UrlPath\":\"$REPLY\"
    #echo $url
    #curl 10.212.81.164:8081/debug -X POST -H "Content-Type:application/json" -d '{"PprofStart":0,"PprofStop":0,"UseMerge":1,"Compare":1,${url},”Clear”:0}' 
    #echo '{"PprofStart":0,"PprofStop":0,"UseMerge":1,"Compare":1,'${url}',”Clear”:0}'
    curl 10.39.40.26:8081/debug -X POST -H "Content-Type:application/json" -d '{"PprofStart":0,"PprofStop":0,"UseMerge":1,"CompareCurl":1,'${url}',"Clear":0,"CompareFile":0}'  >/dev/null 2>&1
        read
    done
}

#tail -f write_test | read_line
tail -f  noc-api.log | grep " match " | grep -E "metrics\/find\/|\/render\/|\/tree\/" | awk -F "GET " '{print $2}' | awk -F " " '{print $1}' | awk -F " HTTP/1.1" '{print $1}' | read_line


sh sleep.sh >/dev/null 2>&1 &


0> cat kill.sh 
ps aufx | grep sleep.sh | grep -v grep | awk -F ' ' '{print $2}' | xargs -I {} kill -9 {}
ps aufx | grep curl | grep -v grep | awk -F " " '{print $2}' | xargs -I {} kill -9 {}
ps aufx | grep curl
ps aufx | grep sleep
```

- 发包脚本

```
0>cat sendip.sh 
while true
do
sendip  -p  ipv4 -is 2.2.2.2 -id 10.39.40.26 -p udp -ud 8333 -f package1 10.13.80.98
sendip  -p  ipv4 -is 2.2.2.2 -id 10.39.40.26 -p udp -ud 8333 -f package2 10.13.80.98
done
```

- 匹配子串

```
匹配子串，保存匹配的字符，如s/(love)able/\1rs，loveable被替换成lovers。
```

- 判断存在与否

```
cat tmp.sh 
#!/bin/bash

#params: conf_item_name,  conf_item_value, conf_file
#not support conf item name with "." for now. and only for toml conf file.

#  相等返回0,不等返回1,错误返回2
CONF_ITEM_NAME=$1
CONF_ITEM_VALUE=$2
CONF_FILE=$3

if [[ $CONF_ITEM_NAME == "" || $CONF_ITEM_VALUE == "" || $CONF_FILE == "" ]]; then
    echo "Invalid params, should be: conf_item_name,  conf_item_value, conf_file"
    exit 2
fi

if [[ ! -f $CONF_FILE ]]; then
   echo "Error: $CONF_FILE does not exist."
   exit 2
fi


RET=`cat $CONF_FILE | grep $CONF_ITEM_NAME | grep -v grep`

RET=`cat $CONF_FILE | grep -E "$CONF_ITEM_NAME\s*=\s*" | grep -v "#" | awk -F "=" '{print $2}' |sed s/[[:space:]]//g | grep -v grep`
echo RET=$RET
LEN=`cat $CONF_FILE | grep -E "$CONF_ITEM_NAME\s*=\s*" | grep -v "#" | awk -F "=" '{print $2}' |sed s/[[:space:]]//g | grep -v grep | wc -l`
echo LEN$LEN
if [[ $LEN == "1" ]]; then
    if [[ $RET == $CONF_ITEM_VALUE ]]; then
	echo "equal"
    	exit 0
    fi
    echo "not equal"
    exit 1
fi
echo "more than one value"
exit 2
```

- 